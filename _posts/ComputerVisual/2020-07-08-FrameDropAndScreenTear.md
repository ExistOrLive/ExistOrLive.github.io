---
layout: article
title:  "计算机显示器系统，屏幕卡顿以及撕裂的原理"
date:   2020-07-07
tags: "计算机基础"
key : "FrameDropAndScreenTear"
excerpt_type: "html"
article_header:
  type: cover
  image:
    src: /screenshot.jpg
---

# 显示器系统

## 1. 光栅扫描显示器

**光栅扫描显示器**是通过电子枪自上而下逐行扫描屏幕来显示画面的显示设备。

当一帧画面扫描完成，电子枪便复位开始扫描下一帧的数据。显示器扫描一帧时间是固定的（即刷新频率），通常是每秒60帧。

![](https://gitee.com/existorlive/exist-or-live-pic/raw/master/%E6%88%AA%E5%B1%8F2020-12-16%20%E4%B8%8A%E5%8D%881.17.15.png)

## 2. 显示器系统的组成

在计算机系统中， **CPU**、**GPU**、**显示器**以下图的方式协同工作。**CPU** 计算好显示内容提交到 **GPU**，**GPU** 渲染完成后将渲染结果放入**帧缓冲区**；**视频控制器**会则按固定的频率读取帧缓冲区的数据，经过数模转换传递给**显示器**显示。

![](https://gitee.com/existorlive/exist-or-live-pic/raw/master/%E5%B1%8F%E5%B9%95%E6%98%BE%E5%83%8F%E5%8E%9F%E7%90%86.png)

## 3. 掉帧/卡顿问题

**显示器**以固定的频率(60Hz或者更高)刷新，而**CPU**和**GPU**计算和渲染的速度取决于当前这一帧画面计算的复杂度。当**GPU**不能及时地将渲染后的数据放入**帧缓冲区**，**显示器**就会重复显示同一帧的画面。这种情况称为**掉帧**或**卡顿**。

![](https://gitee.com/existorlive/exist-or-live-pic/raw/master/%E6%88%AA%E5%B1%8F2020-12-16%20%E4%B8%8A%E5%8D%882.00.19.png)

为了处理**掉帧**问题，通常会使用**双帧缓冲区**甚至**三帧缓冲区**。**GPU**会预先渲染好一帧放入一个**帧缓冲区**内，让**视频控制器**读取，当下一帧渲染好后，**GPU**会把**视频控制器**的指针指向第二个**帧缓冲器**，如此一来效率会有很大的提升。

但是**掉帧**的根本原因还是**CPU/GPU渲染流水线过长**，不会因为增加缓冲区而根本解决。

## 4. 画面撕裂问题

在**双缓冲区**的结构下，当显示器从**帧缓冲区A**读取数据扫描一帧画面，而**GPU**渲染好新的一帧数据放入**帧缓冲区B**中。如果**视频控制器**直接将指针指向**帧缓冲区B**，则会造成**画面撕裂**问题（上半截画面属于旧的一帧，下半截画面属于新的一帧）。

![](https://gitee.com/existorlive/exist-or-live-pic/raw/master/ios_vsync_off.jpg)


**垂直同步(V-Sync)信号**能够很好的解决**画面撕裂**问题。当显示器完成了一帧画面的扫描，便会发出一次**垂直同步信号**。此时，**视频控制器**才能指向新的**帧缓冲区**，**GPU**也才会渲染新的一帧数据。

引入**垂直同步信号**后，**GPU**要等到收到垂直同步信号，才会渲染下一帧。一定程度上拖慢了GPU渲染的速度。




